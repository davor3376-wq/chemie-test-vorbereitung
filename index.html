<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chemie Master 2026 - Pr√ºfungsvorbereitung</title>
    <meta name="description" content="Interaktive Lernplattform f√ºr Chemie (Sekundarstufe). Offlinef√§hig, Druckoptimiert.">
    
    <style>
        /* --- CSS VARIABLEN & RESET --- */
        :root {
            --primary: #0b3d91; /* Marineblau */
            --primary-light: #3b6db3;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --radius: 12px;
            --font-main: system-ui, -apple-system, sans-serif;
        }

        /* High Contrast Mode Class */
        body.high-contrast {
            --primary: #000080;
            --primary-light: #0000ff;
            --bg: #ffffff;
            --card-bg: #ffffff;
            --text: #000000;
            --text-muted: #222222;
            --border: #000000;
        }

        * { box-sizing: border-box; transition: all 0.2s ease-in-out; }
        
        body {
            font-family: var(--font-main);
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            line-height: 1.6;
            padding-bottom: 80px; /* Space for footer */
        }

        /* --- LAYOUT & TYPOGRAPHY --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        h1, h2, h3 { color: var(--primary); margin-top: 0; line-height: 1.2; }
        h1 { font-size: 1.8rem; font-weight: 800; }
        
        /* --- COMPONENTS --- */
        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            gap: 8px;
            font-size: 1rem;
        }
        
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-light); transform: translateY(-1px); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-outline:hover { background: rgba(11, 61, 145, 0.05); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.9rem; }

        .badge {
            padding: 4px 8px;
            border-radius: 99px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .badge-beginner { background: #dbeafe; color: #1e40af; }
        .badge-master { background: #fce7f3; color: #9d174d; }

        /* --- NAVIGATION --- */
        header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 0.5rem 0;
        }
        
        .nav-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            overflow-x: auto;
            padding: 0 1rem;
        }

        .nav-tabs { display: flex; gap: 0.5rem; }
        .nav-tab {
            padding: 0.75rem 1rem;
            color: var(--text-muted);
            background: transparent;
            border: none;
            cursor: pointer;
            font-weight: 600;
            border-bottom: 3px solid transparent;
        }
        .nav-tab.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* --- MODULE VIEWS --- */
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- INTERACTIVE ELEMENTS --- */
        .input-group { margin-bottom: 1rem; }
        .input-field {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
        }
        .input-field:focus { border-color: var(--primary); outline: none; }

        /* Progress Bar */
        .progress-track { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--success); width: 0%; transition: width 1s ease; }

        /* Periodic Table Mini */
        .pt-grid { display: grid; grid-template-columns: repeat(18, 1fr); gap: 2px; margin: 1rem 0; overflow-x: auto; }
        .pt-cell {
            aspect-ratio: 1;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem;
            cursor: pointer;
            background: white;
        }
        .pt-cell:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .pt-empty { border: none; background: transparent; pointer-events: none; }

        /* Redox Steps */
        .step-container { border-left: 3px solid var(--border); padding-left: 1.5rem; margin: 1.5rem 0; position: relative; }
        .step-container.active { border-color: var(--primary); }
        .step-circle {
            position: absolute; left: -11px; top: 0;
            width: 20px; height: 20px;
            background: var(--bg); border: 3px solid var(--border);
            border-radius: 50%;
        }
        .step-container.active .step-circle { border-color: var(--primary); background: var(--primary); }

        /* Flashcards */
        .flashcard {
            perspective: 1000px; height: 200px; cursor: pointer;
        }
        .flashcard-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s; transform-style: preserve-3d;
        }
        .flashcard.flipped .flashcard-inner { transform: rotateY(180deg); }
        .flashcard-front, .flashcard-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            display: flex; align-items: center; justify-content: center;
            border-radius: var(--radius); border: 2px solid var(--primary);
            font-size: 1.2rem; font-weight: bold; padding: 1rem; text-align: center;
        }
        .flashcard-front { background: white; color: var(--primary); }
        .flashcard-back { background: var(--primary); color: white; transform: rotateY(180deg); }

        /* --- PRINT STYLES --- */
        @media print {
            body { background: white; color: black; font-size: 12pt; padding: 0; }
            header, .nav-wrapper, .btn, .no-print { display: none !important; }
            .container { max-width: 100%; padding: 0; margin: 0; }
            .card { box-shadow: none; border: 1px solid #ccc; break-inside: avoid; margin-bottom: 20px; padding: 10px; }
            .view-section { display: block !important; } /* Show all for "Print All" if needed, or specific logic */
            .print-only { display: block !important; }
            
            /* Spickzettel Optimization */
            #view-spicker { display: block !important; }
            .hide-on-print { display: none; }
        }
        .print-only { display: none; }

        /* Dev Mode */
        #dev-panel {
            position: fixed; bottom: 10px; right: 10px;
            background: rgba(0,0,0,0.8); color: lime;
            padding: 10px; border-radius: 8px; font-family: monospace;
            font-size: 0.8rem; z-index: 9999; max-width: 300px;
            display: none;
        }
    </style>
</head>
<body>

    <!-- HEADER & NAV -->
    <header class="no-print">
        <div class="container nav-wrapper">
            <div style="display:flex; align-items:center; gap:10px;">
                <div style="width:30px; height:30px; background:var(--primary); border-radius:50%;"></div>
                <div>
                    <div style="font-weight:800; font-size:1.1rem;">Chemie Master</div>
                    <div style="font-size:0.8rem; color:var(--text-muted);">Pr√ºfung: 14.01.2026</div>
                </div>
            </div>
            <nav class="nav-tabs" id="main-nav">
                <!-- Tabs injected by JS -->
            </nav>
            <div style="font-size:0.9rem;">
                <span id="user-level" class="badge badge-beginner">Beginner</span>
                <span style="margin-left:5px;">üî• <span id="streak-count">0</span></span>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="container">
        
        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard" class="view-section active">
            <div class="card" style="background: linear-gradient(135deg, var(--primary), var(--primary-light)); color: white;">
                <h2>Willkommen zur√ºck!</h2>
                <p>Dein Lernplan f√ºr den Test am 14.01. ist bereit.</p>
                <div style="display:flex; gap:1rem; margin-top:1rem;">
                    <div style="flex:1;">
                        <small>Gesamtfortschritt</small>
                        <div class="progress-track" style="background:rgba(255,255,255,0.3);"><div id="main-progress" class="progress-fill" style="background:white;"></div></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3><span role="img" aria-label="Target">üéØ</span> Heutiger Fokus: Redox</h3>
                <p>Du hast gestern bei den Teilgleichungen noch Fehler gemacht. Lass uns das wiederholen.</p>
                <button class="btn btn-primary" onclick="app.router.go('redox')">Zum Redox-Tutor</button>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div class="card">
                    <h3>Schnellzugriff</h3>
                    <div style="display:flex; flex-direction:column; gap:0.5rem;">
                        <button class="btn btn-outline btn-sm" onclick="app.router.go('atom')">Atomaufbau</button>
                        <button class="btn btn-outline btn-sm" onclick="app.router.go('config')">Elektronenkonfiguration</button>
                        <button class="btn btn-outline btn-sm" onclick="app.router.go('bonds')">Bindungen & EN</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Tools & Downloads</h3>
                    <button class="btn btn-outline btn-sm" style="width:100%; margin-bottom:5px;" onclick="app.printSpicker()">üñ®Ô∏è Spickzettel drucken</button>
                    <button class="btn btn-outline btn-sm" style="width:100%;" onclick="app.startAssessment()">üìù Einstufungstest</button>
                </div>
            </div>
        </section>

        <!-- ATOMAUFBAU VIEW -->
        <section id="view-atom" class="view-section">
            <div class="card">
                <h2>Atomaufbau & Modelle</h2>
                <p>Das <strong>Orbitalmodell</strong> ist f√ºr die Pr√ºfung entscheidend. Protonen im Kern, Elektronen in Wahrscheinlichkeitsr√§umen.</p>
                <div id="atom-visualizer" style="height:300px; background:#111; border-radius:12px; position:relative; overflow:hidden; display:flex; justify-content:center; align-items:center;">
                    <!-- SVG injected via JS -->
                </div>
                <div style="margin-top:1rem; display:flex; justify-content:center; gap:10px;">
                    <select id="atom-select" class="input-field" style="width:auto;" onchange="app.modules.atom.render(this.value)">
                        <option value="1">Wasserstoff (H)</option>
                        <option value="6">Kohlenstoff (C)</option>
                        <option value="8">Sauerstoff (O)</option>
                        <option value="11">Natrium (Na)</option>
                    </select>
                </div>
            </div>
        </section>

        <!-- ELEKTRONENKONFIGURATION VIEW -->
        <section id="view-config" class="view-section">
            <div class="card">
                <h2>Elektronenkonfiguration</h2>
                <div class="input-group">
                    <label>Element eingeben (Symbol oder Ordnungszahl):</label>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="config-input" class="input-field" placeholder="z.B. Fe, O, 26">
                        <button class="btn btn-primary" onclick="app.modules.config.calc()">Berechnen</button>
                    </div>
                </div>
                <div id="config-result" style="display:none;">
                    <div class="card" style="background:var(--bg); border:none;">
                        <h3>Ergebnis f√ºr <span id="config-el-name"></span></h3>
                        <p><strong>Langform:</strong> <span id="config-long" style="font-family:monospace;"></span></p>
                        <p><strong>Edelgasnotation:</strong> <span id="config-noble" style="font-family:monospace; color:var(--primary); font-weight:bold;"></span></p>
                        <p><strong>Schalen (K, L, M...):</strong> <span id="config-shells"></span></p>
                    </div>
                    <!-- Interactive Orbital Filling Visualization could go here -->
                </div>
                <div class="card">
                    <h3>√úbung: Konfiguration bestimmen</h3>
                    <p>Gib die Konfiguration f√ºr <strong>Chlor (Cl)</strong> an:</p>
                    <input type="text" id="config-ex-input" class="input-field" placeholder="1s2...">
                    <button class="btn btn-outline btn-sm" onclick="app.ui.showHint('config-hint')">Tipp</button>
                    <div id="config-hint" class="hidden" style="margin-top:5px; color:var(--text-muted); font-size:0.9rem;">Tipp: Chlor hat 17 Elektronen. Neon ist das vorherige Edelgas.</div>
                </div>
            </div>
        </section>

        <!-- BINDUNGEN & EN VIEW -->
        <section id="view-bonds" class="view-section">
            <div class="card">
                <h2>Chemische Bindungen & EN-Rechner</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem;">
                    <div>
                        <input type="text" id="en-el1" class="input-field" placeholder="Element 1 (z.B. Na)">
                    </div>
                    <div>
                        <input type="text" id="en-el2" class="input-field" placeholder="Element 2 (z.B. Cl)">
                    </div>
                </div>
                <button class="btn btn-primary" style="width:100%; margin-top:1rem;" onclick="app.modules.bonds.calc()">Bindung bestimmen</button>
                
                <div id="bond-result" class="card" style="margin-top:1.5rem; display:none; background:var(--bg); border-color:var(--primary);">
                    <h3 id="bond-type-title">Ionenbindung</h3>
                    <p>ŒîEN = <strong id="bond-delta">2.23</strong></p>
                    <p id="bond-explanation">Da die Differenz gr√∂√üer als 1.7 ist, werden Elektronen √ºbertragen.</p>
                </div>

                <div style="margin-top:2rem;">
                    <h3>Grenzwerte (Faustregel)</h3>
                    <div style="display:flex; height:20px; border-radius:10px; overflow:hidden;">
                        <div style="width:23%; background:#a5d8ff;" title="Unpolar"></div>
                        <div style="width:40%; background:#60a5fa;" title="Polar"></div>
                        <div style="width:37%; background:#1d4ed8;" title="Ionisch"></div>
                    </div>
                    <div style="display:flex; justify-content:space-between; font-size:0.8rem;">
                        <span>0.0</span><span>0.4</span><span>1.7</span><span>Max</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- REDOX TUTOR VIEW -->
        <section id="view-redox" class="view-section">
            <div class="card">
                <h2>Redox-Balancer & Tutor</h2>
                <p>Schritt-f√ºr-Schritt Ausgleich mit der Teilgleichungsmethode.</p>
                
                <div style="display:flex; gap:10px; margin-bottom:1.5rem;">
                    <button class="btn btn-outline btn-sm" onclick="app.modules.redox.loadExample('zn')">Beispiel: Zn + Cu¬≤‚Å∫</button>
                    <button class="btn btn-outline btn-sm" onclick="app.modules.redox.loadExample('fe')">Beispiel: Fe + O‚ÇÇ</button>
                </div>

                <div id="redox-workspace" style="display:none;">
                    <h3 id="redox-title"></h3>
                    <div id="redox-steps-display"></div>
                    <div style="display:flex; justify-content:space-between; margin-top:1.5rem;">
                        <button class="btn btn-outline" onclick="app.modules.redox.reset()">Neu starten</button>
                        <button class="btn btn-primary" id="redox-next-btn" onclick="app.modules.redox.nextStep()">N√§chster Schritt ‚ñ∂</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- SPICKZETTEL VIEW (Print) -->
        <section id="view-spicker" class="view-section">
            <div class="card print-only">
                <h1 style="text-align:center;">Chemie Spickzettel 2026</h1>
                <div style="column-count: 2; column-gap: 2rem;">
                    <article>
                        <h3>1. Oxidationszahlen Regeln</h3>
                        <ul>
                            <li>Elemente (z.B. Fe, O‚ÇÇ) = 0</li>
                            <li>Einatomige Ionen = Ladung</li>
                            <li>Fluor = -1</li>
                            <li>Wasserstoff = +1 (meistens)</li>
                            <li>Sauerstoff = -2 (au√üer Peroxide)</li>
                            <li>Summe im Molek√ºl = 0</li>
                        </ul>
                    </article>
                    <article>
                        <h3>2. Bindungsarten (ŒîEN)</h3>
                        <ul>
                            <li><strong>0.0 - 0.4:</strong> Unpolare Atombindung (e‚Åª symmetrisch)</li>
                            <li><strong>0.5 - 1.7:</strong> Polare Atombindung (Dipol)</li>
                            <li><strong>> 1.7:</strong> Ionenbindung (Gitter)</li>
                        </ul>
                    </article>
                    <article>
                        <h3>3. Orbitalmodell</h3>
                        <p>s-Orbital: Kugel (max 2e‚Åª)<br>p-Orbital: Hantel (max 6e‚Åª)</p>
                        <p><strong>Besetzung:</strong> 1s ‚Üí 2s ‚Üí 2p ‚Üí 3s ‚Üí 3p ‚Üí 4s ‚Üí 3d</p>
                    </article>
                    <article>
                        <h3>4. Redox-Schritte</h3>
                        <ol>
                            <li>Ox-Zahlen bestimmen</li>
                            <li>Oxidation/Reduktion identifizieren</li>
                            <li>Teilgleichungen (e‚Åª Ausgleich)</li>
                            <li>Ladungsausgleich (falls sauer/basisch)</li>
                            <li>KGV bilden & Multiplizieren</li>
                            <li>Addieren & K√ºrzen</li>
                        </ol>
                    </article>
                </div>
            </div>
        </section>

    </div>

    <!-- DEV MODE OVERLAY -->
    <div id="dev-panel">
        <strong>Dev Mode</strong><br>
        <div id="dev-log"></div>
    </div>

    <!-- JAVASCRIPT -->
    <script>
        /* --- DATENBANK --- */
        const DB = {
            elements: {
                1: {s:'H', n:'Wasserstoff', en:2.2, c:'1s1'},
                2: {s:'He', n:'Helium', en:0, c:'1s2'},
                3: {s:'Li', n:'Lithium', en:0.98, c:'[He] 2s1'},
                6: {s:'C', n:'Kohlenstoff', en:2.55, c:'[He] 2s2 2p2'},
                7: {s:'N', n:'Stickstoff', en:3.04, c:'[He] 2s2 2p3'},
                8: {s:'O', n:'Sauerstoff', en:3.44, c:'[He] 2s2 2p4'},
                11: {s:'Na', n:'Natrium', en:0.93, c:'[Ne] 3s1'},
                17: {s:'Cl', n:'Chlor', en:3.16, c:'[Ne] 3s2 3p5'},
                26: {s:'Fe', n:'Eisen', en:1.83, c:'[Ar] 4s2 3d6'},
                29: {s:'Cu', n:'Kupfer', en:1.9, c:'[Ar] 4s1 3d10'},
                30: {s:'Zn', n:'Zink', en:1.65, c:'[Ar] 4s2 3d10'}
            },
            redoxExamples: {
                'zn': {
                    title: "Zink reagiert mit Kupferionen",
                    steps: [
                        {t:"1. Edukte & Produkte", d:"Zn + Cu¬≤‚Å∫ ‚Üí Zn¬≤‚Å∫ + Cu"},
                        {t:"2. Oxidationszahlen", d:"Zn(0), Cu(+II), Zn(+II), Cu(0)"},
                        {t:"3. Teilgleichungen", d:"Ox: Zn ‚Üí Zn¬≤‚Å∫ + 2e‚Åª<br>Red: Cu¬≤‚Å∫ + 2e‚Åª ‚Üí Cu"},
                        {t:"4. Elektronenausgleich", d:"Beide 2e‚Åª ‚Üí keine Multiplikation n√∂tig."},
                        {t:"5. Gesamtreaktion", d:"Zn + Cu¬≤‚Å∫ ‚Üí Zn¬≤‚Å∫ + Cu"}
                    ]
                },
                'fe': {
                    title: "Eisenrostung (Eisen + Sauerstoff)",
                    steps: [
                        {t:"1. Reaktionsgleichung", d:"Fe + O‚ÇÇ ‚Üí Fe‚ÇÇO‚ÇÉ (unbalanciert)"},
                        {t:"2. Oxidationszahlen", d:"Fe: 0, O: 0 ‚Üí Fe: +III, O: -II"},
                        {t:"3. Elektronenbilanz (pro Atom)", d:"Ox: Fe ‚Üí Fe¬≥‚Å∫ + 3e‚Åª<br>Red: O + 2e‚Åª ‚Üí O¬≤‚Åª (Achtung O‚ÇÇ!)"},
                        {t:"4. Korrekte Teilgleichungen", d:"Ox: Fe ‚Üí Fe¬≥‚Å∫ + 3e‚Åª<br>Red: O‚ÇÇ + 4e‚Åª ‚Üí 2O¬≤‚Åª"},
                        {t:"5. KGV & Multiplikation", d:"KGV(3,4) = 12.<br>Ox √ó 4: 4Fe ‚Üí 4Fe¬≥‚Å∫ + 12e‚Åª<br>Red √ó 3: 3O‚ÇÇ + 12e‚Åª ‚Üí 6O¬≤‚Åª"},
                        {t:"6. Addition & Salzbildung", d:"4Fe + 3O‚ÇÇ ‚Üí 4Fe¬≥‚Å∫ + 6O¬≤‚Åª ‚Üí 2Fe‚ÇÇO‚ÇÉ"}
                    ]
                }
            }
        };

        /* --- HAUPTAPP --- */
        const app = {
            state: {
                level: 'Beginner',
                points: 0,
                streak: 0,
                devMode: false
            },

            init() {
                this.loadProgress();
                this.router.init();
                this.ui.renderNav();
                // Check Dev Mode via URL hash #dev
                if(window.location.hash.includes('dev')) this.toggleDevMode();
            },

            /* --- MODULE: ROUTING & UI --- */
            router: {
                routes: ['dashboard', 'atom', 'config', 'bonds', 'redox', 'spicker'],
                go(route) {
                    document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
                    document.getElementById(`view-${route}`).classList.add('active');
                    
                    // Update Nav
                    document.querySelectorAll('.nav-tab').forEach(el => el.classList.remove('active'));
                    const btn = document.getElementById(`nav-${route}`);
                    if(btn) btn.classList.add('active');
                    
                    window.scrollTo(0,0);
                },
                init() { this.go('dashboard'); }
            },

            ui: {
                renderNav() {
                    const nav = document.getElementById('main-nav');
                    const labels = {
                        dashboard: 'Dashboard', atom: 'Atombau', config: 'e‚Åª Konfig',
                        bonds: 'Bindungen', redox: 'Redox', spicker: 'Spickzettel'
                    };
                    nav.innerHTML = app.router.routes.map(r => 
                        `<button id="nav-${r}" class="nav-tab" onclick="app.router.go('${r}')">${labels[r]}</button>`
                    ).join('');
                },
                showHint(id) { document.getElementById(id).style.display = 'block'; }
            },

            /* --- MODUL: ATOMBAU --- */
            modules: {
                atom: {
                    render(z) {
                        const el = DB.elements[z];
                        // Simuliertes SVG Generierung
                        const svg = `<svg viewBox="0 0 200 200" width="100%" height="100%">
                            <circle cx="100" cy="100" r="10" fill="#f59e0b" />
                            <text x="100" y="104" text-anchor="middle" fill="black" font-size="8">${el.s}</text>
                            <circle cx="100" cy="100" r="40" fill="none" stroke="#666" stroke-width="1" opacity="0.5"/>
                            <circle cx="100" cy="100" r="70" fill="none" stroke="#666" stroke-width="1" opacity="0.5"/>
                            ${this.getElectrons(z)}
                        </svg>`;
                        document.getElementById('atom-visualizer').innerHTML = svg;
                    },
                    getElectrons(count) {
                        let svg = '';
                        // Vereinfachte Darstellung: 1. Schale max 2, 2. Schale max 8
                        let shells = [2, 8, 18];
                        let r = [40, 70, 95];
                        let remaining = count;
                        
                        shells.forEach((max, i) => {
                            let current = Math.min(remaining, max);
                            if(current > 0) {
                                for(let j=0; j<current; j++) {
                                    let angle = (j/current)*Math.PI*2;
                                    let x = 100 + Math.cos(angle)*r[i];
                                    let y = 100 + Math.sin(angle)*r[i];
                                    svg += `<circle cx="${x}" cy="${y}" r="4" fill="#3b82f6" />`;
                                }
                                remaining -= current;
                            }
                        });
                        return svg;
                    }
                },

                /* --- MODUL: KONFIGURATION --- */
                config: {
                    calc() {
                        let val = document.getElementById('config-input').value.trim();
                        let z = 0;
                        
                        // Versuche Symbol lookup
                        const entry = Object.entries(DB.elements).find(([k,v]) => v.s.toLowerCase() === val.toLowerCase());
                        if(entry) z = parseInt(entry[0]);
                        else z = parseInt(val);

                        if(!z || !DB.elements[z]) {
                            alert("Element nicht in der Datenbank (Verf√ºgbar: H, He, Li, C, N, O, F, Na, Cl, Fe, Cu, Zn)");
                            return;
                        }

                        const el = DB.elements[z];
                        document.getElementById('config-result').style.display = 'block';
                        document.getElementById('config-el-name').innerText = `${el.n} (${el.s})`;
                        document.getElementById('config-noble').innerText = el.c;
                        document.getElementById('config-long').innerText = this.genLong(z);
                        document.getElementById('config-shells').innerText = this.genShells(z);
                    },
                    genLong(z) {
                        // Hardcoded logic for standard Aufbaprinzip for Demo
                        const order = ["1s2", "2s2", "2p6", "3s2", "3p6", "4s2", "3d10"];
                        let res = "";
                        let rem = z;
                        for(let orb of order) {
                            let cap = parseInt(orb.slice(2));
                            let take = Math.min(rem, cap);
                            if(take > 0) res += orb.slice(0,2) + take + " ";
                            rem -= take;
                            if(rem <= 0) break;
                        }
                        return res;
                    },
                    genShells(z) {
                        // K, L, M logic simplified
                        let arr = [];
                        let rem = z;
                        [2, 8, 18, 32].forEach(max => {
                            let take = Math.min(rem, max);
                            if(take > 0) arr.push(take);
                            rem -= take;
                        });
                        return arr.join(" | ");
                    }
                },

                /* --- MODUL: BINDUNGEN --- */
                bonds: {
                    calc() {
                        const s1 = document.getElementById('en-el1').value.trim();
                        const s2 = document.getElementById('en-el2').value.trim();
                        const e1 = Object.values(DB.elements).find(e => e.s.toLowerCase() === s1.toLowerCase());
                        const e2 = Object.values(DB.elements).find(e => e.s.toLowerCase() === s2.toLowerCase());

                        if(!e1 || !e2) { alert("Element nicht gefunden"); return; }

                        const diff = Math.abs(e1.en - e2.en).toFixed(2);
                        document.getElementById('bond-result').style.display = 'block';
                        document.getElementById('bond-delta').innerText = diff;
                        
                        let type = "Unpolar";
                        let color = "#a5d8ff";
                        if(diff > 0.4) { type = "Polar"; color = "#60a5fa"; }
                        if(diff > 1.7) { type = "Ionenbindung"; color = "#1d4ed8"; }
                        
                        document.getElementById('bond-type-title').innerText = type;
                        document.getElementById('bond-result').style.borderColor = color;
                    }
                },

                /* --- MODUL: REDOX --- */
                redox: {
                    currentExample: null,
                    stepIndex: 0,
                    loadExample(key) {
                        this.currentExample = DB.redoxExamples[key];
                        this.stepIndex = 0;
                        document.getElementById('redox-workspace').style.display = 'block';
                        document.getElementById('redox-title').innerText = this.currentExample.title;
                        document.getElementById('redox-steps-display').innerHTML = '';
                        document.getElementById('redox-next-btn').style.display = 'inline-block';
                        this.renderStep();
                    },
                    renderStep() {
                        const step = this.currentExample.steps[this.stepIndex];
                        const div = document.createElement('div');
                        div.className = 'step-container active';
                        div.innerHTML = `<div class="step-circle"></div><strong>${step.t}</strong><div style="margin-top:5px; font-family:monospace;">${step.d}</div>`;
                        
                        // Deactivate previous
                        const prev = document.getElementById('redox-steps-display').lastElementChild;
                        if(prev) prev.classList.remove('active');
                        
                        document.getElementById('redox-steps-display').appendChild(div);
                    },
                    nextStep() {
                        this.stepIndex++;
                        if(this.stepIndex < this.currentExample.steps.length) {
                            this.renderStep();
                        } else {
                            document.getElementById('redox-next-btn').style.display = 'none';
                        }
                    },
                    reset() {
                        document.getElementById('redox-steps-display').innerHTML = '';
                        this.stepIndex = 0;
                        document.getElementById('redox-next-btn').style.display = 'inline-block';
                        this.renderStep();
                    }
                }
            },

            /* --- SYSTEM FUNCTIONS --- */
            printSpicker() {
                window.print();
            },
            startAssessment() {
                alert("Einstufungstest startet... (Demo: Setze Level auf Intermediate)");
                this.state.level = 'Intermediate';
                this.saveProgress();
                location.reload();
            },
            saveProgress() {
                localStorage.setItem('chemie2026_user', JSON.stringify(this.state));
            },
            loadProgress() {
                const saved = localStorage.getItem('chemie2026_user');
                if(saved) this.state = JSON.parse(saved);
                this.updateUI();
            },
            updateUI() {
                document.getElementById('user-level').innerText = this.state.level;
                // Update Badge color based on level
                const badge = document.getElementById('user-level');
                badge.className = `badge badge-${this.state.level.toLowerCase()}`;
                
                // Progress Bar logic
                let prog = 0;
                if(this.state.level === 'Intermediate') prog = 33;
                if(this.state.level === 'Advanced') prog = 66;
                document.getElementById('main-progress').style.width = prog + '%';
            },
            toggleDevMode() {
                this.state.devMode = !this.state.devMode;
                const panel = document.getElementById('dev-panel');
                panel.style.display = this.state.devMode ? 'block' : 'none';
                if(this.state.devMode) this.runDevTests();
            },
            runDevTests() {
                const log = document.getElementById('dev-log');
                log.innerHTML = "Running Unit Tests...<br>";
                
                // Test 1: Electron Config Fe
                const fe = this.modules.config.genLong(26);
                const pass1 = fe.includes("3d6");
                log.innerHTML += `Config Fe: ${pass1 ? 'PASS' : 'FAIL'}<br>`;

                // Test 2: EN Na-Cl
                const e1 = DB.elements[11]; // Na
                const e2 = DB.elements[17]; // Cl
                const diff = Math.abs(e1.en - e2.en);
                const pass2 = diff > 1.7;
                log.innerHTML += `Bond Na-Cl Ion: ${pass2 ? 'PASS' : 'FAIL'} (${diff.toFixed(2)})<br>`;
            }
        };

        // Start App
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
            app.modules.atom.render(1); // Default Atom view
        });

    </script>
</body>
</html>
